# Disable unnecessary protocols
disable_protocols websocket xdr-streaming xhr-streaming iframe-eventsource iframe-htmlfile xdr-polling iframe-xhr-polling;

# Run as shiny user
run_as shiny;

# Preserve logs
preserve_logs true;

# Global settings
app_init_timeout 60;
app_idle_timeout 300;
sockjs_heartbeat_delay 25;
sockjs_disconnect_delay 60;

# Server configuration
server {
  listen 8080;

  # Define a location for Shiny apps
  location / {
    site_dir /srv/shiny-server;
    log_dir /var/log/shiny-server;
    directory_index off;

    # Application settings
    app_init_timeout 60;
    app_idle_timeout 5;

    # Connection settings
    simple_scheduler 25;

    # Optimized WebSocket options
    sockjs_disconnect_delay 10;
    sockjs_heartbeat_delay 15;
  }

  # Gzip compression for text-based assets
  gzip on;
  gzip_types text/plain text/css application/javascript application/json;
}

# Logging configuration
access_log /var/log/shiny-server/access.log;
error_log /var/log/shiny-server/error.log;
